<html>
    <head>
        <style>
            rect.rect_pos {fill: DarkOrange; stroke: black; }
            rect.rect_neg {fill: LawnGreen; stroke: black; }
            div.chart_title {margin-left: 100px}
        </style>
        
        <script src='https://d3js.org/d3.v5.min.js'></script>
    </head>
    
    <body onload='init()'>
        <h1>CS498 Narrative Visualization Assignment</h1>
        <div class="chart_title">
        <h2>Top Countries by Energy Usage in 2016</h2>
        <div>
        
        <svg width=800 height=800>
        </svg>
        
        <script>
            async function init() {
                const data = await d3.csv(
                'Data/Top5.csv');
                
                console.log(data);
                
                w = 600;
                h = 600;
                mg = 100;
                maxd = 150;
                maxd_neg = 50;
                mid = h * maxd / (maxd + maxd_neg);
                countries = ["CHN", "USA", "RUS", "IND", "JPN"];
                
                xs = d3.scaleBand()
                .domain(countries)
                .range([0, w]);
                ys_pos = d3.scaleLinear()
                .domain([0,maxd])
                .range([0, mid]);
                ys_neg = d3.scaleLinear()
                .domain([0,maxd_neg])
                .range([mid, h]);
                ys_ax = d3.scaleLinear()
                .domain([-maxd_neg,maxd])
                .range([h, 0]);
                
                // positive side
                d3.select("svg")
                .append("g")
                .attr("transform", "translate("+mg+","+mg+")")
                .selectAll("rect")
                .data(data)
                .enter()
                .append("rect")
                .attr("x", function(d,i) {return xs(countries[i]) + 15})
                .attr("y", function(d) {return mid-ys_pos(0)})
                .attr("width", xs.bandwidth()-15)
                .attr("height", function(d) {return ys_pos(0)})
                .attr("class", "rect_pos")
                .transition()
                .attr("y", function(d) {return mid-ys_pos(d.Nonrenewable)})
                .attr("height", function(d) {return ys_pos(d.Nonrenewable)});
                
                // negative side
                d3.select("svg")
                .append("g")
                .attr("transform", "translate("+mg+","+mg+")")
                .selectAll("rect")
                .data(data)
                .enter()
                .append("rect")
                .attr("x", function(d,i) {return xs(countries[i]) + 15})
                .attr("y", function(d) {return mid})
                .attr("width", xs.bandwidth()-15)
                .attr("height", function(d) {return ys_neg(0) - mid})
                .attr("class", "rect_pos")
                .transition()
                .attr("height", function(d) {return ys_neg(d.Renewable) - mid});
                
                // y axis
                d3.select("svg")
                .append("g")
                .attr("transform", "translate("+mg+","+mg+")")
                .call(d3.axisLeft(ys_ax));
                
                // x axis
                d3.select("svg")
                .append("g")
                .attr("transform", "translate("+mg+","+(ys_ax(0)+mg)+")")
                .style("font", "14px times")
                .call(d3.axisBottom(xs));
            }
        </script>
        
    </body>
</html>
